(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{OqcB:function(n,t,e){"use strict";e.r(t);var r=e("Mlb/"),i=e("bb6g"),l=e("TT6o"),a=e("70cc"),s=e("S5zL"),c=e("ODRz");let h=class{constructor(n){this.player=n}initialize(n){this.analyser=n,this.analyser.fftSize=256,this.bufferLength=this.analyser.frequencyBinCount,this.frequencyBarGraphs.barWidth=this.canvasElement.width/this.bufferLength*2.5,this.dataArray=new Uint8Array(this.bufferLength)}ngOnInit(){this.canvasElement=this.canvasElementRef.nativeElement,this.canvasElement.width=window.innerWidth,this.canvasElement.height=window.innerHeight,this.player.analyserChange.pipe(Object(a.a)(n=>!!n)).subscribe(n=>{this.initialize(n),this.drawFrequencyBarGraphs()}),this.frequencyBarGraphs={fullWidth:this.canvasElement.width,fullHeight:this.canvasElement.height,barWidth:0,barHeight:0,x:0,ctx:this.canvasElement.getContext("2d")},this.player.songChange.pipe(Object(s.a)(),Object(a.a)(n=>!!n)).subscribe(n=>{this.generateLyric(n.lyric)}),this.player.progressTime.pipe(Object(a.a)(n=>!!n.original)).subscribe(({original:n})=>{let t=0;for(let e=0;e<this.lyrics.length;e++)n>this.lyrics[e][0]-1&&(t=e);this.currentIndex=t})}drawFrequencyBarGraphs(){this.frequencyBarGraphs.x=0,this.analyser.getByteFrequencyData(this.dataArray),this.frequencyBarGraphs.ctx.clearRect(0,0,this.frequencyBarGraphs.fullWidth,this.frequencyBarGraphs.fullHeight);for(let n=0;n<this.bufferLength;n++)this.frequencyBarGraphs.barHeight=this.dataArray[n],this.frequencyBarGraphs.ctx.fillStyle=`rgb(${this.frequencyBarGraphs.barHeight+n/this.bufferLength*150}, ${n/this.bufferLength*20}, 10)`,this.frequencyBarGraphs.ctx.fillRect(this.frequencyBarGraphs.x,this.frequencyBarGraphs.fullHeight-this.frequencyBarGraphs.barHeight,this.frequencyBarGraphs.barWidth,this.frequencyBarGraphs.barHeight),this.frequencyBarGraphs.x+=this.frequencyBarGraphs.barWidth+1;requestAnimationFrame(this.drawFrequencyBarGraphs.bind(this))}generateLyric(n=""){const t=decodeURIComponent(escape(window.atob(n||"")));this.lyrics=function(n){let e=t.split("\n");const r=/\[\d{2}:\d{2}.\d{2}\]/g,i=[];for(;!r.test(e[0]);)e=e.slice(1);0===e[e.length-1].length&&e.pop();for(const t of e){const n=t.indexOf("]"),e=t.substring(0,n+1),r=t.substring(n+1),l=e.substring(1,e.length-2).split(":");i.push([60*parseInt(l[0],10)+parseFloat(l[1]),r])}return i.sort((n,t)=>n[0]-t[0]),i}()}ngOnDestroy(){}};h=i.a([Object(c.a)()],h);class u{}var o=e("fYis"),p=e("vk2e"),f=r.mb({encapsulation:0,styles:[[".lyric-wrapper[_ngcontent-%COMP%]{position:absolute;width:650px;height:65%;top:100px;left:50%;-webkit-transform:translateX(-325px);transform:translateX(-325px);overflow:hidden;z-index:10}.lyric-wrapper[_ngcontent-%COMP%]   .lyric-inner[_ngcontent-%COMP%]{transition:top .3s ease-out;-webkit-transform-origin:0 0 0;transform-origin:0 0 0;position:absolute;left:10px;right:10px;top:280px}.lyric-wrapper[_ngcontent-%COMP%]   .lyric-inner[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{overflow:hidden;height:42px;line-height:42px;text-overflow:ellipsis;white-space:nowrap;font-size:16px;color:rgba(225,225,225,.6);text-align:center;margin:0}.lyric-wrapper[_ngcontent-%COMP%]   .lyric-inner[_ngcontent-%COMP%]   p.active[_ngcontent-%COMP%]{font-size:20px;color:#fff}canvas[_ngcontent-%COMP%]{position:fixed;left:0;top:0;width:100vw;height:100vh}"]],data:{}});function b(n){return r.Fb(0,[(n()(),r.ob(0,0,null,null,4,"p",[],null,null,null,null,null)),r.Ab(512,null,p.r,p.s,[r.q,r.r,r.k,r.B]),r.nb(2,278528,null,0,p.i,[p.r],{ngClass:[0,"ngClass"]},null),r.zb(3,{active:0}),(n()(),r.Db(4,null,["",""]))],function(n,t){var e=n(t,3,0,t.context.index===t.component.currentIndex);n(t,2,0,e)},function(n,t){n(t,4,0,t.context.$implicit[1])})}function g(n){return r.Fb(0,[r.Bb(402653184,1,{canvasElementRef:0}),(n()(),r.ob(1,0,null,null,3,"div",[["class","lyric-wrapper"]],null,null,null,null,null)),(n()(),r.ob(2,0,null,null,2,"div",[["class","lyric-inner"]],[[4,"top","px"]],null,null,null,null)),(n()(),r.db(16777216,null,null,1,null,b)),r.nb(4,278528,null,0,p.j,[r.M,r.J,r.q],{ngForOf:[0,"ngForOf"]},null),(n()(),r.ob(5,0,[[1,0],["canvas",1]],null,0,"canvas",[],null,null,null,null,null))],function(n,t){n(t,4,0,t.component.lyrics)},function(n,t){n(t,2,0,300-42*(t.component.currentIndex+1))})}function y(n){return r.Fb(0,[(n()(),r.ob(0,0,null,null,1,"biger-home",[],null,null,null,g,f)),r.nb(1,245760,null,0,h,[l.a],null,null)],function(n,t){n(t,1,0)},null)}var d=r.kb("biger-home",h,y,{},{},[]),w=e("qk26");e.d(t,"MusicModuleNgFactory",function(){return x});var x=r.lb(u,[],function(n){return r.vb([r.wb(512,r.j,r.Y,[[8,[o.a,d]],[3,r.j],r.v]),r.wb(4608,p.m,p.l,[r.s,[2,p.u]]),r.wb(1073742336,p.c,p.c,[]),r.wb(1073742336,w.l,w.l,[[2,w.q],[2,w.k]]),r.wb(1073742336,u,u,[]),r.wb(1024,w.i,function(){return[[{path:"",component:h}]]},[])])})}}]);